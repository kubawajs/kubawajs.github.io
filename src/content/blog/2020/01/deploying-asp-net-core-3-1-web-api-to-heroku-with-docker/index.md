---
title: Deploy ASP.NET Core 3.1 Web API to Heroku with Docker
description: Unlock the potential of deploying your .NET Core 3.1 API on Heroku through Docker, as I guide you in this step-by-step tutorial
publishDate: 2020-01-31T00:00:00Z
tags: 
  - "devops"
  - "docker"
  - "dotnet"
  - "dotnetcore"
  - "heroku"
img: "/assets/images/2020/01/deploying-asp-net-core-3-1-web-api-to-heroku-with-docker/images/chuttersnap-six16i5cyra-unsplash.jpg"
img_alt: ""
---

**As you may know, Heroku do not officially support .NET and .NET Core, but it doesn't mean that you can't deploy to it your application written in one of these technologies. In today's post I will show you how to deploy your .NET Core 3.1 API to Heroku using Docker and how to avoid issues that may occur during this process.**

#### Prerequisites:

- [Docker for Windows](https://docs.docker.com/docker-for-windows/)
- [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli)

## Create a project in Visual Studio

We are starting from creating new project in Visual Studio. In today's post we'll use Web API template. Remember to select checkbox with Docker Support - it will automatically generate Dockerfile for your project which we'll need later.

![](https://jakubwajs.files.wordpress.com/2020/01/image-2.png?w=1024)

**Remember** - even if you use Windows to application development, your Docker image should be prepared for Linux.

If you have Docker installed, but not running you will see the following message box after creating project. Of course choose 'Yes' if you don't want to see errors in the future.

![](https://jakubwajs.files.wordpress.com/2020/01/image-3.png?w=502)

**Issue #1:** If you select Windows Docker Support, you will get the following error while trying to build a docker image:

![](https://jakubwajs.files.wordpress.com/2020/01/image-9.png?w=864)

_Image operating system "windows" cannot be used on this platform._

## Prepare dockerfile

When you open Dockerfile generated by project template you should see the following content:

![](https://jakubwajs.files.wordpress.com/2020/01/image-4.png?w=1010)

Although we didn't change anything in the Dockerfile or in the cs files, attempting to build the image would end in error. I was googling a lot on how to repair this file with as few changes as possible and after many errors I've finally successfully build an image with following Dockerfile:

```shell
FROM mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base
WORKDIR /app

FROM mcr.microsoft.com/dotnet/core/sdk:3.1-buster AS build
WORKDIR /src
COPY ["HerokuDockerDeployment.csproj", "HerokuDockerDeployment"]
RUN dotnet restore "HerokuDockerDeployment/HerokuDockerDeployment.csproj"
WORKDIR "/src/HerokuDockerDeployment"
COPY . .
RUN dotnet build "HerokuDockerDeployment.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "HerokuDockerDeployment.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
CMD ASPNETCORE_URLS=http://*:$PORT dotnet HerokuDockerDeployment.dll
```

## Create Heroku app

The most difficult part of the process is behind us, now it's time for some clicking ;) Go to [Heroku website](https://www.heroku.com/) and log in or sign up if you don't have account yet. Then click on _New_ and _Create new app_ as shown on the screen.

![](https://jakubwajs.files.wordpress.com/2020/01/image-7.png?w=318)

Enter the name you like and select the region (closest to you would be the best). Remember the name of the application - you will need it in the next steps. Click on _Create app_ button - your app is now ready.

![](https://jakubwajs.files.wordpress.com/2020/01/image-5.png?w=637)

## Create docker image

Now open the PowerShell console in the project folder (not solution!). For example, for my project it is: _~/source/repos/<solution-name>/<project-name>_. Then run the following command to build a docker image (don't forget the _dot_ at the end!):

```shell
docker build -t <docker-image-name> .
```

**Issue #2:** If Docker is not running on your machine, you will get the following error:

![](https://jakubwajs.files.wordpress.com/2020/01/image-8.png?w=859)

_Error during connect_ Docker issue.

If command was completed successfully, use the _[tag](https://docs.docker.com/engine/reference/commandline/tag/)_ command to tag from your source image into target image (on Heroku).

```shell
docker tag <docker-image-name> registry.heroku.com/<heroku-app-name>/web
```

## Use Heroku CLI

The last part covers deployment of created image to Heroku. We're starting with logging from PowerShell console to Heroku and then to container using Heroku CLI commands.

```shell
heroku login
heroku container:login
```

Next, push the container to Heroku:

```shell
heroku container:push web -a <heroku-app-name>
```

And finally - release your work to web:

```shell
heroku container:release web -a <heroku-app-name>
```

**Issue #3:** If you make a mistake in your _Dockerfile_ or use _ENTRYPOINT_ command instead of _CMD_ with dynamic _PORT_ assignment you will see the following error:

![](https://jakubwajs.files.wordpress.com/2020/01/image-10.png?w=1024)

_Unable to start Kestrel_.

## Testing Result

Now we need to check whether our application is publicly available. This is another moment when the previously assigned name for our application is important - the domain of the hosted application consists of the application name and suffix _.herokuapp.com_. In my case it is _herokudockerdeployment.herokuapp.com_.

![](https://jakubwajs.files.wordpress.com/2020/01/image-6.png?w=508)

Final view of published example .NET Core 3.1 API on Heroku.

I hope that thanks to this tutorial you will publish your .NET Core application on Heroku quickly and without any issues. Good luck!

### Sources:

- [https://blog.devcenter.co/deploy-asp-net-core-2-0-apps-on-heroku-eea8efd918b6](https://blog.devcenter.co/deploy-asp-net-core-2-0-apps-on-heroku-eea8efd918b6)

* * *

_Hero photo by [chuttersnap](https://unsplash.com/@chuttersnap?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/container?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)_
